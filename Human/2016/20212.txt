Generalizing the Kelly strategy

Prompted by a recent experiment by Victor Haghani and Richard Dewey, this note generalises the Kelly strategy (optimal for simple investment games with log utility) to a large class of practical utility functions and including the effect of extraneous wealth.
  A counterintuitive result is proved : for any continuous, concave, differentiable utility function, the optimal choice at every point depends only on the probability of reaching that point.
  The practical calculation of the optimal action at every stage is made possible through use of the binomial expansion, reducing the problem size from exponential to quadratic.
  Applications include (better) automatic investing and risk taking under uncertainty.
